# Integrating API Connect with a 3rd Party OpenID Connect Provider (IBM blueID)

## Register an Application in the API Connect Developer Portal

1. Log in to the Developer Portal for your desired Catalog

1. Give the application a name

1. Select to show the Client ID

    1. Save the value to a notepad

1. Select to show the Client Secret

    1. Save the value to a notepad

## Register a BlueID Application and Client

1.	Launch the IBM SSO Self-Service Portal:

    <https://w3.innovate.ibm.com/tools/sso/home.html>

1.	Click on the Register a blueID application link

1.	Accept the Terms and Conditions

1.	Fill out the Application Details form

    1.	The details here would be for the API you’re developing

    1.	Select the Pre-Production identity provider

    1.	Register a blueID Client Application

    1.	Provide a unique Client Name

    1.	Remove the auto-generated Client ID and Client Secret

    1.	Enter a Redirect URI

    1.	Enter the Client ID and Client Secret from the Application generated by the APIC Developer Portal

    1.	Select the desired grant types

    1.	Take note of the endpoints

    1.	Click the Continue button

1.	Confirm the details, scroll to the bottom and click the Save and Continue button

1.	You will receive an email stating that the application request was received, then a few minutes later a second email stating that it is approved successfully.

## Configure your API to use blueID ODIC

1.	Launch the API Designer from your toolkit or within the API Manager server.

1.	Work with an existing API, create a new OpenAPI or import the sample below

    1.	link goes here

1.	Navigate to the Security Definitions section

1.	Ensure that you have security definitions that require the Client ID and Client Secret, both are required for blueID OIDC to work.

1.	Create a new Security Definition for OAuth

    1.	Scroll down to configure the OAuth security definition

    1.	Provide a definition name and chose the desired grant type flow

        1.	Password will require that you provide the blueID email and password pre-emptively

        1.	Access code will redirect your client to the blueID authorization website for entry of the email and password

    1.	Enter the blueID endpoints

    1.	Create a new scope called openid

1.	Scroll down to the Security section of the API definition and ensure all three Security Definitions are selected, along with the openid scope.

## Publish and subscribe to the API Product

1.	Create a new Product and add your API definition

1. Publish the product to your desired catalog

1. Log in to the Catalog’s Developer Portal

1. Select the API Products tab and select your product

1. Click the Subscribe button to link your Developer Portal Application to the API Product

## Test the API

Note: The IBM blueID IDAAS prohibits cross-orgin requests from client-side browser applications. Unfortunately, this means we cannot use the API Connect Developer Portal to obtain a token from the blueID system. To test the API, you need to use a server-side application that does not enforce CORS restrictions like the browser does. In the following section, I’m using an API test client called Paw for macOS.

1.	Launch your test client and set up the API request

    1.	Use your API endpoint provided by your Developer Portal

1.	 Set the client credential headers

    1.	Use your Client ID and Client Secret from your application registration in the Developer Portal. These should also match what is registered in the blueID client configuration.

1.	If you send a test request now, you will receive an error code because no authentication token has been set.

1.	Set up the authentication to obtain a token

    1.	Select the Grant Type

    1.	Provide the Client ID and Client Secret

    1.	Enter the Authorization URL (if necessary depending on grant type. and the Access Token URL for the blueID IDAAS system.

    1.	Set the scope to openid

1.	Paw provides the ability to automatically obtain a token on API requests. This is a handy feature that will fetch a token if one is not present, or use the refresh token if yours has expired.

1.	Click on the Get Access Token button
    1.	In my scenario, I’m using the Authorization Code (3-Legged OAuth Grant Type. flow. A pop-up window will ask me to enter my IBMid and Password.

        Note: We selected the Pre-Production identity provider when setting up the blueID client. If you do not have an email account in the Pre-Production system, use the Create an IBMid link to set up an account before trying to log in.

    1.	Once you sign-in, Paw will automatically recognize the access token and allow you to save it for use in your API calls. Click the Use Access Token button.

1.	You’re now ready to call the API hosted on the IBM API Connect platform. Click the Send Request button and view the response.
